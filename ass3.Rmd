---
title: "R Notebook"
author: "Ann Elisabeth Jacobsen og Heidi Marie Rolfsnes"
lang: nb-NO
output: pdf_document
---

```{r setup, echo = FALSE}
suppressMessages(library(tidyverse))
suppressMessages(library(tibble))
suppressMessages(library(gapminder))
suppressMessages(library(readr))
suppressMessages(library(knitr))
suppressMessages(library(dplyr))
options(scipen = 999)
```

## 1. What information does the file ddf_concepts.csv contain?

Filen ddf--concepts.csv ser ut til å inneholde en kort beskrivelse av
datasettene som finnes i mappen *countries-etc-datapoints*.

## 2. What information does the file ddf---entities--geo---country.csv contain?

Beskrivelse av hvert enkelt land i datasettet slik som navn,
forkortelse, verdensdel, geografiske koordinater, forkortelser etc.

## 3. What information does the the file ddg_entities--geo--un_sdg_region.csv contain?

Gir oss ulike regioner definert av FN. Ser at Australia og New Zealand
er en egen region etter denne definisjonen.

## 4. What variables does the gapminder dataset from the gapminder package contain? To what continent are Australia and New Zealand assigned?

    #142 land

    #5 kontinenter

    #Årene 1957 til 2007

    #Folketall (population)

    #BnP per inbygger.

    ```{r Informasjon om utvalget}
    gapminder
    ```

## 5. Recreate the continent variable in gapminder with the new data?

Vi flytter Australia og New Zealand fra Asia til Osceania for å være på line med gapminder
    

```{r Nytt datasett}
g_c <- read_csv("data/ddf--entities--geo--country.csv")
print(g_c)
```

    Ser at Australia og New Zealand tilhører kontinentet Osceania i gapminder datasettet.
    
    
```{r}
spec(g_c)
```
    

```{r}
g_c <- g_c %>%
   mutate(continent = case_when(
     world_4region == "asia" & un_sdg_region %in% c("un_australia_and_new_zealand","un_oceania_exc_australia_and_new_zealand") ~ "Oceania",
     world_4region == "asia" & !(un_sdg_region %in% c("un_australia_and_new_zealand", "un_oceania_exc_australia_and_new_zealand")) ~ "Asia",
     world_4region == "africa" ~ "Africa",
     world_4region == "americas" ~ "Americas",
     world_4region == "europe" ~ "Europe")
   ) %>% 
   filter(!is.na(iso3166_1_alpha3))
```


## 6. How many countries are there now?

```{r Land}
length(unique(g_c$country))
```

Nå er det 247 land.

## 6b) How many countries are there now in each continent?

```{r Land i det ulike kontinentene}
g_c %>%
  group_by(continent) %>%
  summarise(countries= length(unique(country)))
```

## 7. Create the variable Life Expectancy (lifeExp) in g_c from the file

```{r forventet levetid i antall land}
lifeExp <- read_csv("data/countries-etc-datapoints/ddf--datapoints--life_expectancy_years--by--geo--time.csv",
col_types = cols(time = col_date(format = "%Y")))
lifeExp <- lifeExp %>% 
  rename(year = time)
names(lifeExp)
length(unique(lifeExp$geo))
```


## 8. How many countries have information about lifeExp?

    195 land har informasjon om levetid.
```{r Levetid land}
length(unique(lifeExp$geo))
```
    

## 9. reduce g_c to the variables: country, name, iso3166_1_alpha3,un_sdg_region, world_4region, continent, world_6region

```{r Reduser variabler}
g_c <- g_c %>%
  select(country, name, iso3166_1_alpha3, un_sdg_region, world_4region, continent, world_6region) %>%
  left_join(lifeExp, by = c("country" = "geo"))
```
    
```{r navn}
names(g_c)
```

## 10. What is the first observation of lifeExp for the different countries?

```{r levetid i ulike land}
    g_c_min <- g_c %>%
      group_by(country) %>%
      summarise(min_year = min(lifeExp$year))
      table(g_c_min$min_year)
```

De første 186 observasjonene er fra 1800, mens de resterende 9 er fra 1950.

## 11. What are the name of the 9 countries that only have life expectancy

```{r forventet levetid}
g_c_min <- g_c_min %>%
  left_join(g_c,
            by = "country") %>%
  filter(min_year == "1950-01-01")
tibble(country = unique(g_c_min$name))
```

## 12. Read in the total_population and join with g_c


```{r folketall}
pop <- read_csv("data/countries-etc-datapoints/ddf--datapoints--population_total--by--geo--time.csv",
                 col_types = cols(time = col_date(format = "%Y")))
```

```{r}
g_c <- g_c %>%
  left_join(pop, by = c("country" = "geo", "year" ="time"))
```

## 13. Read in the gdp_percapita_us_inflation_adjusted and call it "gdp_pc" Rename life_expectancy_years to lifeExp, population_total to pop and gdppercapita_us_inflation_adjusted to gdpPercap

    ```{r Datasett}
    gdp_pc <- read_csv("data/countries-etc-datapoints/ddf--datapoints--gdppercapita_us_inflation_adjusted--by--geo--time.csv",
 col_types = cols(time = col_date(format = "%Y")))
    ```

```{r}
 g_c <- g_c %>%
      left_join(gdp_pc, by = c("country" = "geo", "year" = "time"))
rm(gdp_pc)
```

    ```{r nye navn}
    g_c <- g_c %>%
      rename(lifeExp = "life_expectancy_years") %>%
      rename(pop = "population_total") %>%
      rename(gdpPercap = "gdppercapita_us_inflation_adjusted") 
    
    # %>%
      # g_c flyter alt i pipen og vil være første argument til names
      #names(g_c)
      #names()
    ```

```{r navn g_c}
# denne for å se variabel navnene. Farlig i pipe hvor en tilornder som ovenfor. Ender opp med at g_c 
# bare innholder variabelnavnene og ingenting annet
names(g_c)
```

## 14. As in gapminder use data from every 5th year, but include 2019 at the end.

```{r Data fra hvert femte år}
t1 <- paste(c(seq(1800,2015, by = 5), 2019), "01-01", sep = "-") %>%
  parse_date(format = "%Y-%m-%d")

g_c_5 <- g_c %>%
  filter(year %in% t1) %>%
  select(country, name, continent, year, lifeExp, pop, gdpPercap)

dim(g_c_5)
```

```{r}
g_c_gdpprc <- g_c_5 %>% 
  group_by(gdpPercap) %>% 
  summarise(min_year = min(year))

table(g_c_gdpprc$min_year)
```

## 15. Make a vector containing the names of the countries with the longest time series for gdp per capita

```{r vector}
g_c <- g_c %>%
  filter(!is.na(gdpPercap)) %>%
  group_by(name) %>%
    summarise(nr = n()) %>%
    arrange(name)

print(g_c)
```

## 16. make a subset of gapminder, my_gapminder_1960, which include countries with data from 1960-2019. How many countries are now in the dataset? How many countries from each continent? how many NAs are there in my_gapminder_1960

```{r}
c_m_y_60 <- g_c_5 %>%
      filter(!is.na(gdpPercap)) %>%
      # name trengs ikke her i group_by men triks for å få name variabelen med i output
      group_by(country, name) %>%
      summarise(min_year = min(year))
  
head(c_m_y_60)
```

```{r}
# Plukker ut det minste min_year (første år vi har data for)
fy <- c_m_y_60 %>% 
  mutate(
    aar = as.numeric(lubridate::year(min_year))
  )
  
first_year <- paste(min(fy$aar), "01", "01", sep = "-")
```

```{r}
#land med data fra 1960
country_1960 <- c_m_y_60 %>% 
  filter(min_year == first_year) %>% 
  select(country) %>% 
  # for å få country ut av tibblene
  pull()
# nå har vi en vector med 85 land forkortelser for dem som har data fra 1960
```

```{r}
dim(c_m_y_60)
```
   
```{r}
#c_m_y_60 <- my_gapminder_60$country[my_gapminder_60$min_year == "1960-01-01"]

my_gapminder_60 <- g_c_5 %>%
  filter(!is.na(gdpPercap)) %>% 
  filter(country %in% country_1960)


my_gapminder_60 
```
      
```{r observasjoner}
dim(my_gapminder_60)
```
      
```{r antall land }
length(unique(my_gapminder_60$country))
```
```{r}
# kommentert ut for å få dokumentet til å kjøre
#num_NA <- sum(is.na(c_m_y_60$gdpPercap))
```
```{r}
#paste("Number of NAs in g_c_1960 is", dim(num_NA)[1], sep = " ")
```

```{r Kontinenter}
my_gapminder_60 %>%
  distinct(country, continent) %>%
  group_by(continent) %>%
  count() %>%
  kable()
```


## 17. Use ggplot() and let x be gdpPercap, y be lifeExp and size the population. Make a plot for each of the year 1960, 1980, 2000 and 2019.

```{r 1960}
    my_gapminder_60 %>%
      filter(year <= "1960-01-01") %>%
      ggplot(mapping = aes(x = gdpPercap, y = lifeExp, size = pop, colour = continent)) +
      geom_point() +
      coord_cartesian(ylim = c(20, 90), xlim = c(0,110000)) +
       ggtitle("1960") +
      theme(legend.position = "bottom")
```

```{r 1980}
    my_gapminder_60 %>%
      filter(year == "1980-01-01") %>%
      ggplot(mapping = aes(x = gdpPercap, y = lifeExp, size = pop, colour = continent)) +
      geom_point() +
      coord_cartesian(ylim = c(20, 90), xlim = c(0,110000)) +
       ggtitle("1980") +
      theme(legend.position = "bottom")
```

```{r 2000}
     my_gapminder_60 %>%
      filter(year == "2000-01-01") %>%
      ggplot(mapping = aes(x = gdpPercap, y = lifeExp, size = pop, colour = continent)) +
      geom_point() +
      coord_cartesian(ylim = c(20, 90), xlim = c(0,110000)) +
       ggtitle("2000") +
      theme(legend.position = "bottom")
```

```{r 2019}
     my_gapminder_60 %>%
      filter(year == "2019-01-01") %>%
      ggplot(mapping = aes(x = gdpPercap, y = lifeExp, size = pop, colour = continent)) +
      geom_point() +
      coord_cartesian(ylim = c(20, 90), xlim = c(0,110000)) +
       ggtitle("2019") +
      theme(legend.position = "bottom")
```

## 18. Do the same four plots as above, but now use the log transform of gdpPercap, i.e mapping.

```{r log1960}
my_gapminder_60 %>%
  filter(year == "1960-01-01") %>%
  ggplot(mapping = aes(x = log(gdpPercap), y = lifeExp, size = pop, colour = continent)) +
  # coord_cartesian() helt greit, men disse to er kanskje lettere å huske
  xlim(5, 12) +  
  ylim(20, 90) +
  geom_point() +
  # coord_cartesian(ylim = c(20, 90), xlim = c(5, 11)) +
  ggtitle("1960") +
  theme(legend.position = "bottom")
```

```{r log1980}
my_gapminder_60 %>%
  filter(year == "1980-01-01") %>%
  ggplot(mapping = aes(x = log(gdpPercap), y = lifeExp, size = pop, colour = continent)) +
  # coord_cartesian() helt greit, men disse to er kanskje lettere å huske
  xlim(5, 12) +  
  ylim(20, 90) +
  geom_point() +
  # coord_cartesian(ylim = c(20, 90), xlim = c(5, 11)) +
  ggtitle("1980") +
  theme(legend.position = "bottom")
```

```{r log2000}
my_gapminder_60 %>%
  filter(year == "2000-01-01") %>%
  ggplot(mapping = aes(x = log(gdpPercap), y = lifeExp, size = pop, colour = continent)) +
  # coord_cartesian() helt greit, men disse to er kanskje lettere å huske
  xlim(5, 12) +  
  ylim(20, 90) +
  geom_point() +
  # coord_cartesian(ylim = c(20, 90), xlim = c(5, 11)) +
  ggtitle("2000") +
  theme(legend.position = "bottom")
```

```{r log2019}
my_gapminder_60 %>%
  filter(year == "2019-01-01") %>%
  ggplot(mapping = aes(x = log(gdpPercap), y = lifeExp, size = pop, colour = continent)) +
  # coord_cartesian() helt greit, men disse to er kanskje lettere å huske
  xlim(5, 12) +  
  ylim(20, 90) +
  geom_point() +
  # coord_cartesian(ylim = c(20, 90), xlim = c(5, 11)) +
  ggtitle("2019") +
  theme(legend.position = "bottom")
```

## 19. How will you characterise the development the 59 years from 1960 to 2019?

    Levetiden har økt betraktelig fra 1960 til 2019.

## 20. Save your datafiles as my_gapminder.csv and my_gapminder_red.csv
```{r Lagre datafiler}
write.table(g_c_5, file="my_gapminder.csv", sep = ",")
#write.table(g_c_1960, file="my_gapminder_red.csv", sep = ",")
# try to use tidyverse functions
write_csv(my_gapminder_60, file = "my_gapminder_60.csv")
```

```{r, echo = FALSE}
#siste
```

